# -*- coding: utf-8 -*-
"""datasets.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1L5K01VAc0xi6P4XjQKw3WxzBIcILiiSL
"""

import sys
sys.path.append('/content/ultrasound-needle-eraser')

import torch
from torch.utils.data import Dataset
from src.main.loader import UltrasoundNeedleDataset

class CycleGANDataset(Dataset):
    def __init__(self, image_dir_A, image_dir_B, img_size=(256,256)):
        #domain a: images with needles
        self.dataset_A = UltrasoundNeedleDataset(image_dir_A, mask_dir=None, transform=None)
        #domain b: needle-free images
        self.dataset_B = UltrasoundNeedleDataset(image_dir_B, mask_dir=None, transform=None)
        self.length = max(len(self.dataset_A), len(self.dataset_B))

        #transforms
        import torchvision.transforms as T
        self.transform = T.Compose([
            T.Resize(img_size),
            T.CenterCrop(img_size),
            T.ToTensor(),
        ])

    def __len__(self):
        return self.length

    def __getitem__(self, idx):
        a_img = self.dataset_A[idx % len(self.dataset_A)]["image"]
        b_img = self.dataset_B[idx % len(self.dataset_B)]["image"]

        #apply
        a_img = self.transform(a_img)
        b_img = self.transform(b_img)

        return a_img, b_img